<html>
   <head>
       <title>Restaurant</title>
       <link rel="stylesheet" href="style.css">
       <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css"> -->
   </head>
   <body class="flexcontainer"> 

    <div>

        <h1>Tables</h1>
        <input type="text" id="table" placeholder="Enter the Table Number" onkeyup="SearchTable()"> 
        <div id="tables">
         <div id="Table-1"ondragover="allowDrop(event)" ondrop="drop(event)" >
             <ul >
                <li>Table-1</li>
                <li>0</li>
                <li>0</li>
                <button class="btn">Table-1</button>
             </ul>
         </div>  
             <div id="Table-2" ondragover="allowDrop(event)" ondrop="drop(event)">
                 <ul >
                    <li>Table-2</li>
                    <li>0</li>
                    <li>0</li>
                    <button class="btn">Table-2</button>
                 </ul>
             </div>
             <div id="Table-3" ondragover="allowDrop(event)" ondrop="drop(event)">
                 <ul >
                    <li>Table-3</li>
                    <li>0</li>
                    <li>0</li>
                    <button class="btn">Table-3</button>
                 </ul>
             </div>
        </div>
    
        </div>



       <div>
    <h1>Food Items</h1>
    <input type="text" id="myInput" placeholder="Enter the food Item" onkeyup="Search()"> 
    <div id="items">
     <div id="rice" draggable="true" ondragstart="dragStart()">
         <ul>
            <li>rice</li>
            <li id="pririce">40.00</li>
            
         </ul>
         
     </div>  
         <div id="biryani" draggable="true" ondragstart="dragStart()">
             <ul>
                <li>biryani</li>
                <li id="pribiryani">80.00</li>
                
             </ul>
             
         </div>
         <div id="chicken" draggable="true" ondragstart="dragStart()"> 
             <ul>
                <li>chicken</li>
                <li id="prichicken">180.00</li>
                
             </ul>
             
         </div>
        <div id="mutton" draggable="true" ondragstart="dragStart()"> 
            <ul>
            <li>mutton</li>
            <li id="primutton">400.00</li>
            
            </ul>
            
        </div> 
        <div id="fish" draggable="true" ondragstart="dragStart()"> 
            <ul>
            <li>fish</li>
            <li id="prifish">206.00</li>
            </ul>
        </div> 
        <div id="icecream" draggable="true" ondragstart="dragStart()"> 
            <ul>
            <li>icecream</li>
            <li id="priicecream">75.00</li>
            </ul>
        </div> 
        <div id="milkshake" draggable="true" ondragstart="dragStart()"> 
            <ul>
            <li>milkshake</li>
            <li id="primilkshake">125.00</li>
            </ul>
        </div> 

    </div>
    </div>
    
    <div class="popup" id="popup-1">
        <div class="overlay"></div>
        <div class="content">
          <div class="close-btn" onclick="togglePopup1()">×</div>
           <h3>Order Details | Table-1</h3>
           <table id="data-price-1">
               <tr>
               <th>sno</th>
               <th>Food Item</th>
               <th>Price</th>
               </tr>
           </table>
        </div>
      </div>

      <div class="popup" id="popup-2">
        <div class="overlay"></div>
        <div class="content">
          <div class="close-btn" onclick="togglePopup2()">×</div>
          <h3>Order Details | Table-2</h3>
          <table id="data-price-2" >
            <tr>
            <th>sno</th>
            <th>Food Item</th>
            <th>Price</th>
            </tr>
        </table>
        </div>
      </div>

      <div class="popup" id="popup-3">
        <div class="overlay"></div>
        <div class="content">
          <div class="close-btn" onclick="togglePopup3()">×</div>
          <h3>Order Deatils | Table-3</h3>
          <table id="data-price-3">
            <tr>
            <th>sno</th>
            <th>Food Item</th>
            <th>Price</th>
            </tr>
        </table>
        </div>
      </div>
      
   </body>
   
    
  <script>
      const Search=()=>{
           let filter=document.getElementById('myInput').value.toUpperCase();
           console.log(filter);
           let divList = document.getElementById('items');
           let list=divList.getElementsByTagName('div');
           for(var i=0;i<list.length;i++){
               let liItems = list[i].getElementsByTagName('li');
             let text=liItems[0].innerText.toUpperCase();
               if(text.toUpperCase().indexOf(filter)>-1){
                    list[i].style.display="";
               }
               else{
                        list[i].style.display='none';
               }
           }
      }

      const SearchTable=()=>{
          let input = document.getElementById('table').value.toUpperCase();
          let mainDiv=document.getElementById('tables');
          let tables = mainDiv.getElementsByTagName('div');
          for(var i=0;i<tables.length;i++){
              let tabItem=tables[i].getElementsByTagName('li');
              let text=tabItem[0].innerText.toUpperCase();
              if(text.toUpperCase().indexOf(input)>-1){
                       tables[i].style.display="";
              }
              else{
                       tables[i].style.display='none';
              } 
          } 
      }
      var list;
      function dragStart(){
        var ele=document.getElementById(event.target.id);
        list=ele.getElementsByTagName('li');
      }

      function allowDrop(){
          event.preventDefault();
      }
       
      function drop(event){ 
          let ele=document.getElementById(event.target.innerText);
          const l=ele.getElementsByTagName('li');
          var quantity=parseInt(l[1].innerText)+1;
          var price=parseFloat(l[2].innerText)+parseFloat(list[1].innerText);
         let li = document.createElement('li');
          li.textContent=list[0].innerText;
          let ul = ele.getElementsByTagName('ul');
          li.className="menu";
          li.style.display='none';
          ele.append(li); 
          l[1].innerText=quantity;
          l[2].innerText=price;
      }
    
     let buttons=document.getElementsByClassName('btn');
    
         buttons[0].addEventListener('click',togglePopup1);
         buttons[1].addEventListener('click',togglePopup2);
         buttons[2].addEventListener('click',togglePopup3);
         
     
        //Table 1
     function togglePopup1(){
        var table=document.getElementById('Table-1')
        var mainTable=document.getElementById('data-price-1');
        mainTable.querySelectorAll('tr').forEach(n => n.remove());
        var no__items=table.getElementsByClassName('menu');
        var items=new Array();
        for(var i=0;i<no__items.length;i++){
               items.push(no__items[i].innerText);
        }
        var set = new Set(items);
         mp=getFrequency(items);
         var index=0;
        for (const k of set.values()) {
            //document.getElementById('data-price-1').innerHTML+="<li>"+k+":"+mp[k]+"</li>"
            let tr=document.createElement('tr');
            let sno=document.createElement('td');
            let item=document.createElement('td');
            let count=document.createElement('td');
            let price=document.createElement('td');
            let addbtn=document.createElement('button');
            addbtn.textContent="+";
            let subbtn=document.createElement('button');
            subbtn.textContent="-";
             addbtn.className="tbtn";
             subbtn.className="tbtn";
             addbtn.id=index+" data-price-1 Table-1 "+k.toLowerCase();
             subbtn.id=index+" data-price-1 Table-1 "+k.toLowerCase();
             addbtn.addEventListener('click',addItem);
             subbtn.addEventListener('click',subItem);
            item.textContent=k;
            count.textContent=mp[k];
            sno.textContent=(++index);
            id=k.toLowerCase();
            console.log(document.getElementById("pri"+id))
            price.textContent=document.getElementById("pri"+id).textContent;
            tr.appendChild(sno);
            tr.appendChild(item);
            tr.appendChild(price);
            tr.appendChild(count);
            tr.appendChild(addbtn);
            tr.appendChild(subbtn);
            mainTable.appendChild(tr);
        }
        let tr=document.createElement('tr');
            let head=document.createElement('td');
            let amount=document.createElement('td');
            head.textContent="Total Amount";
            amount.textContent=table.getElementsByTagName('li')[2].innerText;
            amount.colSpan="5";
            tr.appendChild(head);
            tr.appendChild(amount);
            mainTable.appendChild(tr);
            document.getElementById("popup-1").classList.toggle("active");

     }



  //table-2

     function togglePopup2(){
        var table=document.getElementById('Table-2')
        var mainTable=document.getElementById('data-price-2');
        mainTable.querySelectorAll('*').forEach(n => n.remove());
        var no__items=table.getElementsByClassName('menu');
        var items=new Array();
        for(var i=0;i<no__items.length;i++){
               items.push(no__items[i].innerText);
        }
        var set = new Set(items);
         mp=getFrequency(items);
         var index=0;
        for (const k of set.values()) {
            //document.getElementById('data-price-1').innerHTML+="<li>"+k+":"+mp[k]+"</li>"
            let tr=document.createElement('tr');
            let sno=document.createElement('td');
            let item=document.createElement('td');
            let count=document.createElement('td');
            let price=document.createElement('td');
            let addbtn=document.createElement('button');
            addbtn.textContent="+";
            let subbtn=document.createElement('button');
            subbtn.textContent="-";
             addbtn.className="tbtn";
             subbtn.className="tbtn";
             addbtn.id=index+" data-price-2 Table-2 "+k.toLowerCase();
             subbtn.id=index+" data-price-2 Table-2 "+k.toLowerCase();
             addbtn.addEventListener('click',addItem);
             subbtn.addEventListener('click',subItem);
            item.textContent=k;
            count.textContent=mp[k];
            sno.textContent=(++index);
            id=k.toLowerCase();
            console.log(document.getElementById("pri"+id))
            price.textContent=document.getElementById("pri"+id).textContent;
            tr.appendChild(sno);
            tr.appendChild(item);
            tr.appendChild(price);
            tr.appendChild(count);
            tr.appendChild(addbtn);
            tr.appendChild(subbtn);
            mainTable.appendChild(tr);
        }
        let tr=document.createElement('tr');
            let head=document.createElement('td');
            let amount=document.createElement('td');
            head.textContent="Total Amount";
            amount.textContent=table.getElementsByTagName('li')[2].innerText;
            amount.colSpan="5";
            tr.appendChild(head);
            tr.appendChild(amount);
            mainTable.appendChild(tr);
            document.getElementById("popup-2").classList.toggle("active");

     }


     function togglePopup3(){
        var table=document.getElementById('Table-3')
        var mainTable=document.getElementById('data-price-3');
        mainTable.querySelectorAll('*').forEach(n => n.remove());
        var no__items=table.getElementsByClassName('menu');
        var items=new Array();
        for(var i=0;i<no__items.length;i++){
               items.push(no__items[i].innerText);
        }
        var set = new Set(items);
         mp=getFrequency(items);
         var index=0;
        for (const k of set.values()) {
            //document.getElementById('data-price-1').innerHTML+="<li>"+k+":"+mp[k]+"</li>"
            let tr=document.createElement('tr');
            let sno=document.createElement('td');
            let item=document.createElement('td');
            let count=document.createElement('td');
            let price=document.createElement('td');
            let addbtn=document.createElement('button');
            addbtn.textContent="+";
            let subbtn=document.createElement('button');
            subbtn.textContent="-";
             addbtn.className="tbtn";
             subbtn.className="tbtn";
             addbtn.id=index+" data-price-3 Table-3 "+k.toLowerCase();
             subbtn.id=index+" data-price-3 Table-3 "+k.toLowerCase();
             addbtn.addEventListener('click',addItem);
             subbtn.addEventListener('click',subItem);
            item.textContent=k;
            count.textContent=mp[k];
            sno.textContent=(++index);
            id=k.toLowerCase();
            console.log(document.getElementById("pri"+id))
            price.textContent=document.getElementById("pri"+id).textContent;
            tr.appendChild(sno);
            tr.appendChild(item);
            tr.appendChild(price);
            tr.appendChild(count);
            tr.appendChild(addbtn);
            tr.appendChild(subbtn);
            mainTable.appendChild(tr);
        }
        let tr=document.createElement('tr');
            let head=document.createElement('td');
            let amount=document.createElement('td');
            head.textContent="Total Amount";
            amount.textContent=table.getElementsByTagName('li')[2].innerText;
            amount.colSpan="5";
            tr.appendChild(head);
            tr.appendChild(amount);
            mainTable.appendChild(tr);
            document.getElementById("popup-3").classList.toggle("active");

     }



const getFrequency = (array) => {
   const map = {};
   array.forEach(item => {
      if(map[item]){
         map[item]++;
      }else{
         map[item] = 1;
      }
   });
   return map;
};

  function addItem(){
     var ids=event.target.id;
     var arr = ids.split(" ");
     var index=parseInt(arr[0]);
     var table=document.getElementById(arr[1]);
     var rows=table.getElementsByTagName('tr');
     var quantity=parseInt(table.getElementsByTagName('tr')[index].children.item(3).textContent)+1;
     var price=parseFloat(document.getElementById("pri"+arr[3]).textContent)*quantity;
     table.getElementsByTagName('tr')[index].children.item(3).textContent=quantity;
     table.getElementsByTagName('tr')[index].children.item(2).textContent=price;
     if(quantity>0){
        document.getElementsByClassName(event.target.className)[1].style.display='inline';
     }
     //update over the table-1
     var divTable=document.getElementById(arr[2]);
     let addedItem=document.createElement('li');
     addedItem.textContent=arr[3];
     addedItem.className="menu";
     addedItem.style.display='none';
     divTable.appendChild(addedItem);
     var sum=0;
     var total=0;
     for(var i=0;i<rows.length-1;i++){
         sum+=parseInt(rows[i].children.item(3).textContent);
         total+=parseFloat(rows[i].children.item(2).textContent);
     }
     divTable.getElementsByTagName('li')[1].textContent=sum;
     divTable.getElementsByTagName('li')[2].textContent=total;
     rows[rows.length-1].children.item(1).textContent=total;



  }
  function subItem(){
    var ids=event.target.id;
     var arr = ids.split(" ");
     var index=parseInt(arr[0]);
     var table=document.getElementById(arr[1]);
     var rows=table.getElementsByTagName('tr');
     var quantity=parseInt(table.getElementsByTagName('tr')[index].children.item(3).textContent)-1;
     
     var price=parseFloat(document.getElementById("pri"+arr[3]).textContent)*quantity;
     table.getElementsByTagName('tr')[index].children.item(3).textContent=quantity;
     table.getElementsByTagName('tr')[index].children.item(2).textContent=price;
     var total=parseFloat(rows[rows.length-1].children.item(1).textContent);
     total-=parseFloat(document.getElementById("pri"+arr[3]).textContent);
     rows[rows.length-1].children.item(1).textContent=total;
     
     if(quantity<=-1)
     {
         alert("you cannot remove items");
         return;
         
     }
     //update over the table-1
     var divTable=document.getElementById(arr[2]);
     var items=divTable.getElementsByClassName('menu');
     for(var j=0;j<items.length;j++){
        if(items[j].textContent===arr[3])
        {
            divTable.removeChild(items[j]);
            console.log("removeed");
            break;
        }
     }
     var sum=0;
     rows=table.getElementsByTagName('tr');
     for(var i=0;i<rows.length-1;i++){
         sum+=parseInt(rows[i].children.item(3).textContent);
     }
     divTable.getElementsByTagName('li')[1].textContent=sum;
     divTable.getElementsByTagName('li')[2].textContent=total;
  }



  </script>
    
</html>